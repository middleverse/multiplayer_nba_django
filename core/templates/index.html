{% extends 'base.html' %}

{% block navbar %}
  {% include 'index_navbar.html' %}
{% endblock navbar %}

{% block content %}
{% load static %}

  <div class='container ripple-background h-100'>
    <div class='d-none d-lg-block'>
    <div class="circle-ripple-fast large-opp shade3"></div>
    <div class="circle-ripple-fast medium-opp shade4"></div>
    <div class="circle-ripple-fast small-opp shade5"></div>
    </div>
    <div class="circle-ripple xxlarge shade1"></div>
    <div class="circle-ripple xlarge shade2"></div>
    <div class="circle-ripple large shade3"></div>
    <div class="circle-ripple medium shade4"></div>
    <div class="circle-ripple small shade5"></div>

    
    <div class='row align-items-center justify-content-center align-items-lg-end justify-content-lg-end p-5 h-100'>
        <!-- LOGO XS -->
        <div class='col-lg-6 d-md-none d-block col-auto mt-5'>
          <div class='row h-100'>
            <div class='col  text-center mb-5'>
              <img src="{% static 'images/logo_blue_dark.png' %}" alt='RUN AND GUN LOGO'  width='300' height='300'>
            </div>

            
          </div>
        </div>

        <!-- LOGO SM+ -->
        <div class='col-auto d-none d-md-block text-center'>
          <img src="{% static 'images/logo_blue_dark.png' %}" alt='RUN AND GUN LOGO' width='500' height='500'>
        </div>
        
        <!-- GAME JOIN OPTIONS -->
        <div class='col-md-6 bg-dark pt-3 pb-3 rounded'>
          <div class='row justify-content-center m-3'>
            <!-- CREATE -->
            <div class='col-6 col-lg-auto align-self-end'>
              <a class='btn btn-success font-weight-bold btn-lg' role='button' id="create-game" href="{% url 'create_redirect'%}">Create Game</a>
            </div>

            <!-- JOIN -->
            <div class='col-6 col-lg-auto align-self-start'>
              <button class='btn btn-primary font-weight-bold btn-lg' type='button' data-toggle="collapse" href='#join-game-form-wrapper' aria-expanded="false" aria-controls="join-game-form-wrapper">
                Join Game
              </button>

              <!-- FORM -->
              <div id='join-game-form-wrapper' class='collapse'>
                <form id='join-game-form' action="{% url 'join_redirect' %}" method="POST" >
                  {% csrf_token %}
                
                  <div class='input-group mt-3'>
                    <input class='form-control' id="court_id" type="text" placeholder="Enter Court Id..." name="court_id" aria-label="Enter Court Id..." aria-describedby="join-game-button">
                    <div class='input-group-append'>
                      <input class='btn btn-success btn-sm' id='join-game-button' type="submit" value="GO">
                    </div>
                  </div>

                </form>
              </div>
            </div>
          </div>

          <!-- DESCRIPTION TEXT -->
          <div class='row m-3'>
            <div class='col mt-3'><p class='h6 text-light'>Create your own game to invite your friends, or join a game with a game id.</p></div>
          </div>
          

          <div class='row'>
            <a id="faq"></a>
          </div>
            <div id='redirect-error-msg'></div>
        </div>
    </div>
  </div>

<script>
const show_join_error_message = function(e) {
  alert(e)
  document.getElementById('redirect-error-msg').innerContent = e
}

document.getElementById('join-game-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const form = event.target
    const form_data = new FormData(form)
    const court_id = form_data.get('court_id')
    const url = form.getAttribute('action')
    const method = form.getAttribute('method') 
    const xhr = new XMLHttpRequest()
    const responseType = 'json'
    xhr.open(method, url) // make the request 
    xhr.setRequestHeader('HTTP_X_REQUESTED_WITH', 'XMLHttpRequest') // convetion to call setRequestHeader is after open and before send
    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
    
    xhr.onload = function() {
        if (xhr.status === 201) {
            r = xhr.response
            r_json = JSON.parse(r)
            window.location.href = '/court/'
                                  + r_json['message']['court_id']
                                  + '/'
                                  + r_json['message']['role']
                                  + '/'
        }     
        else {
            err_json = JSON.parse(xhr.response)
            show_join_error_message(err_json['message'])
        }
    }
    xhr.onerror = function() {
            alert("An error has occurred.")
    }
    xhr.send(form_data)
});            

</script>

{% endblock content %}